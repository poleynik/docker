input {
  beats {
    port => 5045
  }
}
filter {
grok {
match => [ "message", "%{NUMBER:timestamp}\s+%{DATE:response_time}\s+%{TIME:time}\s+%{NUMBER:number1}\s+%{NOTSPACE:remote_host}\s+-1\s+\S+\s+%{NUMBER:input1}\s+%{NUMBER:status_code}\s+%{NOTSPACE:status}\s+%{NOTSPACE:data}\s+%{NOTSPACE:reqmethod}\s+%{NOTSPACE:requrl}",
           "message", "%{NUMBER:timestamp}\s+%{NUMBER:response_time}\s+%{IP:client_ip}\s+%{WORD:status}/%{NUMBER:status_code}\s+%{NUMBER:request_size}\s+%{NOTSPACE:method}\s+%{NOTSPACE:request_url}\s+%{NOTSPACE:user_name}\s+%{WORD:squid_status}/%{NOTSPACE:client_fqdn}\s+%{NOTSPACE:content_type}"]
}
if [agent][hostname] in ["squid11","squid12","squid03"] {
    mutate {
    add_tag => [ "robots_proxy" ]
  }
}
if [agent][hostname] in ["Proxy1","Proxy2","docker"] {
    mutate {
    add_tag => [ "users_proxy" ]
  }
}


}
output {
  elasticsearch {
    index => "%{[@metadata][beat]}-%{[@metadata][version]}-squid-%{+YYYY.MM.dd}"
    hosts => ["http://192.168.1.42:9200", "http://192.168.118.11:9200"]
    user => 'logstash_writer'
    password => '12345Asd'
  }
    #stdout { codec => rubydebug }
}
